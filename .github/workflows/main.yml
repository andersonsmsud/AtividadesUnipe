name: CI/CD Pipeline em 3 Tarefas

on:
  push:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  testar:
    name: 1. Testar o cÃ³digo
    runs-on: ubuntu-latest
    steps:
      - name: Baixar o cÃ³digo do repositÃ³rio
        uses: actions/checkout@v4

      - name: Rodar testes e verificaÃ§Ãµes de qualidade
        run: echo "âœ… Testes passaram!"

  construir:
    name: 2. Construir o site
    runs-on: ubuntu-latest
    needs: testar
    steps:
      - name: Baixar o cÃ³digo do repositÃ³rio
        uses: actions/checkout@v4

      - name: Construir os arquivos do site
        run: |
          mkdir ./site
          cp index.html ./site/index.html
          echo "ğŸ“¦ Site construÃ­do na pasta 'site'."

      - name: Salvar artefato da construÃ§Ã£o
        uses: actions/upload-pages-artifact@v3
        with:
          path: './site'

  sast:
    name: 1. SAST - Static Application Security Testing
    runs-on: ubuntu-latest
    needs: construir
    steps:
      - name: Baixar o cÃ³digo do repositÃ³rio
        uses: actions/checkout@v4

      - name: Rodar SAST
        run: echo "ğŸ” Rodando anÃ¡lise estÃ¡tica de seguranÃ§a (SAST)..."

  dast:
    name: 2. DAST - Dynamic Application Security Testing
    runs-on: ubuntu-latest
    needs: sast
    steps:
      - name: Baixar o cÃ³digo do repositÃ³rio
        uses: actions/checkout@v4

      - name: Rodar DAST
        run: echo "ğŸŒ Rodando anÃ¡lise dinÃ¢mica de seguranÃ§a (DAST)..."

  deploy:
    name: 3. Deploy
    runs-on: ubuntu-latest
    needs: dast
    steps:
      - name: Baixar o cÃ³digo do repositÃ³rio
        uses: actions/checkout@v4

      - name: Realizar o deploy
        run: echo "ğŸš€ Realizando o deploy..."

  publicar:
    name: 3. Publicar no GitHub Pages
    runs-on: ubuntu-latest
    needs: construir
    steps:
      - name: Publicar o site
        uses: actions/deploy-pages@v4
